---
import { readFileSync } from 'fs';
import { join } from 'path';
import { existsSync } from 'fs';

// Read and parse resume experiences from resume.txt
function parseResumeFile(): Array<{
  id: number;
  title: string;
  organization: string;
  location: string;
  startDate: string;
  endDate: string;
  description: string;
  tags: string[];
  type: string;
  projectLink?: string;
}> {
  // Try multiple possible paths (works in both dev and build)
  const projectRoot = process.cwd();
  const possiblePaths = [
    join(projectRoot, 'src', 'description', 'resume.txt'),
    join(projectRoot, '..', 'src', 'description', 'resume.txt'),
  ];
  
  let resumePath = possiblePaths.find(path => existsSync(path));
  if (!resumePath) {
    // Fallback: assume we're in project root
    resumePath = join(projectRoot, 'src', 'description', 'resume.txt');
  }
  
  const resumeContent = readFileSync(resumePath, 'utf-8');
  
  const experiences: Array<{
    id: number;
    title: string;
    organization: string;
    location: string;
    startDate: string;
    endDate: string;
    description: string;
    tags: string[];
    type: string;
    projectLink?: string;
  }> = [];
  
  // Split by experience separator (regex matches "=== Experience N ===" at start of line)
  const parts = resumeContent.split(/^=== Experience \d+ ===$/m);
  
  // Skip the first part (header/comments) and process each experience block
  for (let i = 1; i < parts.length; i++) {
    const block = parts[i].trim();
    if (!block) continue;
    
    const lines = block.split('\n');
    const experience: {
      id: number;
      title: string;
      organization: string;
      location: string;
      startDate: string;
      endDate: string;
      description: string;
      tags: string[];
      type: string;
      projectLink?: string;
    } = {
      id: i,
      title: '',
      organization: '',
      location: '',
      startDate: '',
      endDate: '',
      description: '',
      tags: [],
      type: '',
      projectLink: undefined
    };
    
    let descriptionLines: string[] = [];
    let inDescription = false;
    
    for (const line of lines) {
      const trimmedLine = line.trim();
      
      // Skip empty lines and comments
      if (!trimmedLine || trimmedLine.startsWith('#')) {
        continue;
      }
      
      // Check if this is a field label
      if (trimmedLine.startsWith('Title:')) {
        inDescription = false;
        experience.title = trimmedLine.substring(6).trim();
      } else if (trimmedLine.startsWith('Organization:')) {
        inDescription = false;
        experience.organization = trimmedLine.substring(13).trim();
      } else if (trimmedLine.startsWith('Location:')) {
        inDescription = false;
        experience.location = trimmedLine.substring(9).trim();
      } else if (trimmedLine.startsWith('Start Date:')) {
        inDescription = false;
        experience.startDate = trimmedLine.substring(11).trim();
      } else if (trimmedLine.startsWith('End Date:')) {
        inDescription = false;
        experience.endDate = trimmedLine.substring(9).trim();
      } else if (trimmedLine.startsWith('Type:')) {
        inDescription = false;
        experience.type = trimmedLine.substring(5).trim();
      } else if (trimmedLine.startsWith('Tags:')) {
        inDescription = false;
        const tagsStr = trimmedLine.substring(5).trim();
        experience.tags = tagsStr.split(',').map(tag => tag.trim()).filter(tag => tag);
      } else if (trimmedLine.startsWith('Project Link:')) {
        inDescription = false;
        experience.projectLink = trimmedLine.substring(13).trim();
      } else if (trimmedLine.startsWith('Description:')) {
        inDescription = true;
        // Description might be on the same line or following lines
        const descText = trimmedLine.substring(12).trim();
        if (descText) {
          descriptionLines.push(descText);
        }
      } else if (inDescription && trimmedLine) {
        // Collect description lines (can be multiple lines)
        descriptionLines.push(trimmedLine);
      }
    }
    
    // Join description lines with spaces
    experience.description = descriptionLines.join(' ').trim();
    
    // Only add if we have at least a title
    if (experience.title) {
      experiences.push(experience);
    }
  }
  
  return experiences;
}

const experiences = parseResumeFile();

// Function to parse date strings and convert to comparable format
function parseDate(dateStr: string): number {
  if (!dateStr) return 0;
  
  const trimmed = dateStr.trim();
  
  // Handle month + year format (e.g., "May 2025", "Dec 2024", "Sept 2023")
  const monthNames: { [key: string]: number } = {
    'jan': 1, 'january': 1,
    'feb': 2, 'february': 2,
    'mar': 3, 'march': 3,
    'apr': 4, 'april': 4,
    'may': 5,
    'jun': 6, 'june': 6,
    'jul': 7, 'july': 7,
    'aug': 8, 'august': 8,
    'sep': 9, 'sept': 9, 'september': 9,
    'oct': 10, 'october': 10,
    'nov': 11, 'november': 11,
    'dec': 12, 'december': 12
  };
  
  const parts = trimmed.toLowerCase().split(/\s+/);
  if (parts.length >= 2) {
    const month = monthNames[parts[0]];
    const year = parseInt(parts[1]);
    if (month && year) {
      // Return year * 100 + month for proper sorting (e.g., 202505 for May 2025)
      return year * 100 + month;
    }
  }
  
  // Handle year-only format (e.g., "2016", "2024")
  // Treat as December of that year for sorting (so it comes after earlier months)
  if (/^\d{4}$/.test(trimmed)) {
    const year = parseInt(trimmed);
    return year * 100 + 12; // December
  }
  
  // Fallback: try to extract year and treat as December
  const yearMatch = trimmed.match(/\d{4}/);
  if (yearMatch) {
    const year = parseInt(yearMatch[0]);
    return year * 100 + 12; // December
  }
  
  return 0;
}

// Sort experiences by endDate (most recent first), then by startDate if endDate is the same
const sortedExperiences = [...experiences].sort((a, b) => {
  const aEndDate = parseDate(a.endDate);
  const bEndDate = parseDate(b.endDate);
  
  // If end dates are the same, sort by start date (most recent first)
  if (aEndDate === bEndDate) {
    const aStartDate = parseDate(a.startDate);
    const bStartDate = parseDate(b.startDate);
    return bStartDate - aStartDate;
  }
  
  return bEndDate - aEndDate;
});

const allTags = [...new Set(sortedExperiences.flatMap(exp => exp.tags))].sort();
const allTypes = [...new Set(sortedExperiences.map(exp => exp.type))].sort();
---

<div class="resume-search">
  <div class="search-controls">
    <div class="search-bar">
      <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"/>
        <path d="m21 21-4.35-4.35"/>
      </svg>
      <input 
        type="text" 
        id="searchInput" 
        class="search-input" 
        placeholder="Search experiences..."
      />
    </div>
    
    <div class="filters">
      <div class="filter-group type-filter-group">  
        <label class="filter-label">Type:</label>
        <div class="type-checkboxes" id="typeCheckboxes">
          {allTypes.map(type => (
            <label class="type-checkbox-label">
              <input 
                type="checkbox" 
                class="type-checkbox" 
                value={type}
                checked
              />
              <span>{type.charAt(0).toUpperCase() + type.slice(1)}</span>
            </label>
          ))}
        </div>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">Tags:</label>
        <select id="tagFilter" class="filter-select">
          <option value="">All Tags</option>
          {allTags.map(tag => (
            <option value={tag}>{tag}</option>
          ))}
        </select>
      </div>
      
      <button id="resumePreviewBtn" class="resume-preview-btn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14 2 14 8 20 8"/>
          <line x1="16" y1="13" x2="8" y2="13"/>
          <line x1="16" y1="17" x2="8" y2="17"/>
          <polyline points="10 9 9 9 8 9"/>
        </svg>
        Resume Preview
      </button>
      
      <button id="resetFilters" class="reset-btn">Reset</button>
    </div>
  </div>
  
  <div class="results-info">
    <span id="resultsCount">{sortedExperiences.length}</span> experiences found
  </div>
  
  <div class="experiences-grid" id="experiencesGrid">
    {sortedExperiences.map(exp => (
      <article 
        class="experience-card" 
        data-id={exp.id}
        data-type={exp.type}
        data-tags={exp.tags.join(',')}
        data-search-text={`${exp.title} ${exp.organization} ${exp.description} ${exp.tags.join(' ')}`.toLowerCase()}
      >
        <div class="experience-header">
          <div class="experience-header-left">
            <label class="resume-select-checkbox">
              <input 
                type="checkbox" 
                class="resume-select-input" 
                data-experience-id={exp.id}
                checked
              />
              <span class="checkbox-label">Include in Resume</span>
            </label>
            <div class="experience-type-badge" data-type={exp.type}>
              {exp.type}
            </div>
          </div>
          <div class="experience-date">
            {exp.startDate} - {exp.endDate}
          </div>
        </div>
        
        <h3 class="experience-title">{exp.title}</h3>
        <div class="experience-org">
          <svg class="org-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
          </svg>
          {exp.organization} • {exp.location}
        </div>
        
        <p class="experience-description">{exp.description}</p>
        
        <div class="experience-footer">
          <div class="experience-tags">
            {exp.tags.map(tag => (
              <span class="tag">{tag}</span>
            ))}
          </div>
          {exp.projectLink && (
            <a 
              href={exp.projectLink.startsWith('http') || exp.projectLink.startsWith('/') 
                ? exp.projectLink 
                : `/projects#project-${exp.projectLink}`}
              class="project-link-btn"
              target={exp.projectLink.startsWith('http') ? '_blank' : undefined}
              rel={exp.projectLink.startsWith('http') ? 'noopener noreferrer' : undefined}
            >
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                <polyline points="15 3 21 3 21 9"/>
                <line x1="10" y1="14" x2="21" y2="3"/>
              </svg>
              View Project
            </a>
          )}
        </div>
      </article>
    ))}
  </div>
  
  <div id="noResults" class="no-results" style="display: none;">
    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
      <circle cx="11" cy="11" r="8"/>
      <path d="m21 21-4.35-4.35"/>
    </svg>
    <h3>No experiences found</h3>
    <p>Try adjusting your search or filters</p>
  </div>
</div>

<!-- Added PDF modal for preview and download -->
<div id="pdfModal" class="pdf-modal">
  <div class="pdf-modal-content">
    <div class="pdf-modal-header">
      <h2>Resume Preview</h2>
      <button id="closeModal" class="close-modal-btn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    
    <div class="pdf-preview-area" id="pdfPreviewArea">
      <div class="pdf-content" id="pdfContent">
        <div class="pdf-header">
          <h1>Academic Resume</h1>
          <p class="pdf-subtitle">Professional Experience & Education</p>
        </div>
        <div id="pdfExperiencesList"></div>
      </div>
    </div>
    
    <div class="pdf-modal-footer">
      <button id="downloadPdfBtn" class="download-pdf-btn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
          <polyline points="7 10 12 15 17 10"/>
          <line x1="12" y1="15" x2="12" y2="3"/>
        </svg>
        Download PDF
      </button>
    </div>
  </div>
</div>

<script>
  import jsPDF from 'jspdf';
  
  const searchInput = document.getElementById('searchInput') as HTMLInputElement;
  const typeCheckboxes = Array.from(document.querySelectorAll('.type-checkbox')) as HTMLInputElement[];
  const tagFilter = document.getElementById('tagFilter') as HTMLSelectElement;
  const resetBtn = document.getElementById('resetFilters') as HTMLButtonElement;
  const experiencesGrid = document.getElementById('experiencesGrid') as HTMLElement;
  const resultsCount = document.getElementById('resultsCount') as HTMLElement;
  const noResults = document.getElementById('noResults') as HTMLElement;
  const cards = Array.from(document.querySelectorAll('.experience-card')) as HTMLElement[];
  const resumeSelectInputs = Array.from(document.querySelectorAll('.resume-select-input')) as HTMLInputElement[];
  
  const resumePreviewBtn = document.getElementById('resumePreviewBtn') as HTMLButtonElement;
  const pdfModal = document.getElementById('pdfModal') as HTMLElement;
  const closeModalBtn = document.getElementById('closeModal') as HTMLButtonElement;
  const downloadPdfBtn = document.getElementById('downloadPdfBtn') as HTMLButtonElement;
  const pdfExperiencesList = document.getElementById('pdfExperiencesList') as HTMLElement;
  
  function getSelectedTypes(): string[] {
    return typeCheckboxes
      .filter(checkbox => checkbox.checked)
      .map(checkbox => checkbox.value);
  }
  
  function getSelectedExperienceIds(): number[] {
    return resumeSelectInputs
      .filter(input => input.checked)
      .map(input => parseInt(input.dataset.experienceId || '0'));
  }
  
  function getVisibleExperiences() {
    const selectedIds = getSelectedExperienceIds();
    // Cards are already in sorted order (most recent first) from the template
    return cards
      .filter(card => {
        const cardId = parseInt(card.dataset.id || '0');
        return card.style.display !== 'none' && selectedIds.includes(cardId);
      })
      .map(card => ({
        title: card.querySelector('.experience-title')?.textContent || '',
        organization: card.querySelector('.experience-org')?.textContent || '',
        date: card.querySelector('.experience-date')?.textContent || '',
        description: card.querySelector('.experience-description')?.textContent || '',
        type: card.dataset.type || '',
        tags: (card.dataset.tags || '').split(',').filter(tag => tag !== '')
      }));
  }
  
  function updatePDFPreview() {
    const experiences = getVisibleExperiences();
    
    if (experiences.length === 0) {
      pdfExperiencesList.innerHTML = '<p class="no-experiences">No experiences to display. Adjust your filters to see results.</p>';
      return;
    }
    
    pdfExperiencesList.innerHTML = experiences.map(exp => `
      <div class="pdf-experience-item">
        <div class="pdf-exp-header">
          <div>
            <h3 class="pdf-exp-title">${exp.title}</h3>
            <p class="pdf-exp-org">${exp.organization}</p>
          </div>
          <span class="pdf-exp-date">${exp.date}</span>
        </div>
        <p class="pdf-exp-description">${exp.description}</p>
        <div class="pdf-exp-tags">
          ${exp.tags.map(tag => `<span class="pdf-tag">${tag}</span>`).join('')}
        </div>
      </div>
    `).join('');
  }
  
  function generatePDF() {
    const experiences = getVisibleExperiences();
    
    if (experiences.length === 0) {
      alert('No experiences to export. Please adjust your filters.');
      return;
    }
    
    const pdf = new jsPDF();
    const pageWidth = pdf.internal.pageSize.getWidth();
    const pageHeight = pdf.internal.pageSize.getHeight();
    const margin = 20;
    const maxWidth = pageWidth - (margin * 2);
    let yPosition = margin;
    
    // Header
    pdf.setFontSize(24);
    pdf.setFont('helvetica', 'bold');
    pdf.text('Academic Resume', margin, yPosition);
    yPosition += 10;
    
    pdf.setFontSize(10);
    pdf.setFont('helvetica', 'normal');
    pdf.setTextColor(100, 100, 100);
    pdf.text('Professional Experience & Education', margin, yPosition);
    yPosition += 15;
    
    // Experiences
    experiences.forEach((exp, index) => {
      // Check if we need a new page
      if (yPosition > pageHeight - 40) {
        pdf.addPage();
        yPosition = margin;
      }
      
      // Type badge
      pdf.setFontSize(8);
      pdf.setFont('helvetica', 'bold');
      pdf.setTextColor(96, 165, 250);
      pdf.text(exp.type.toUpperCase(), margin, yPosition);
      
      // Date
      pdf.setTextColor(150, 150, 150);
      pdf.text(exp.date, pageWidth - margin - 40, yPosition);
      yPosition += 7;
      
      // Title
      pdf.setFontSize(12);
      pdf.setFont('helvetica', 'bold');
      pdf.setTextColor(0, 0, 0);
      pdf.text(exp.title, margin, yPosition);
      yPosition += 6;
      
      // Organization
      pdf.setFontSize(10);
      pdf.setFont('helvetica', 'normal');
      pdf.setTextColor(80, 80, 80);
      const orgText = exp.organization.replace(/\s*•\s*/g, ' - ');
      pdf.text(orgText, margin, yPosition);
      yPosition += 6;
      
      // Description
      pdf.setFontSize(9);
      pdf.setTextColor(60, 60, 60);
      const descLines = pdf.splitTextToSize(exp.description, maxWidth);
      pdf.text(descLines, margin, yPosition);
      yPosition += (descLines.length * 5) + 5;
      
      // Tags
      if (exp.tags.length > 0 && exp.tags[0] !== '') {
        pdf.setFontSize(8);
        pdf.setTextColor(120, 120, 120);
        const tagsText = exp.tags.join(' • ');
        pdf.text(tagsText, margin, yPosition);
        yPosition += 8;
      }
      
      // Separator line
      if (index < experiences.length - 1) {
        pdf.setDrawColor(220, 220, 220);
        pdf.line(margin, yPosition, pageWidth - margin, yPosition);
        yPosition += 8;
      }
    });
    
    // Footer
    const totalPages = pdf.internal.pages.length - 1;
    for (let i = 1; i <= totalPages; i++) {
      pdf.setPage(i);
      pdf.setFontSize(8);
      pdf.setTextColor(150, 150, 150);
      pdf.text(
        `Page ${i} of ${totalPages}`,
        pageWidth / 2,
        pageHeight - 10,
        { align: 'center' }
      );
    }
    
    pdf.save('academic-resume.pdf');
  }
  
  resumePreviewBtn.addEventListener('click', () => {
    updatePDFPreview();
    pdfModal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
  });
  
  closeModalBtn.addEventListener('click', () => {
    pdfModal.style.display = 'none';
    document.body.style.overflow = 'auto';
  });
  
  pdfModal.addEventListener('click', (e) => {
    if (e.target === pdfModal) {
      pdfModal.style.display = 'none';
      document.body.style.overflow = 'auto';
    }
  });
  
  downloadPdfBtn.addEventListener('click', generatePDF);
  
  function filterExperiences() {
    const searchTerm = searchInput.value.toLowerCase();
    const selectedTypes = getSelectedTypes();
    const selectedTag = tagFilter.value;
    
    let visibleCount = 0;
    
    cards.forEach(card => {
      const searchText = card.dataset.searchText || '';
      const cardType = card.dataset.type || '';
      const cardTags = (card.dataset.tags || '').split(',');
      
      const matchesSearch = searchText.includes(searchTerm);
      // Show card if its type is in selected types. If no types selected, show nothing.
      const matchesType = selectedTypes.length > 0 && selectedTypes.includes(cardType);
      const matchesTag = !selectedTag || cardTags.includes(selectedTag);
      
      if (matchesSearch && matchesType && matchesTag) {
        card.style.display = 'block';
        visibleCount++;
      } else {
        card.style.display = 'none';
      }
    });
    
    resultsCount.textContent = visibleCount.toString();
    
    if (visibleCount === 0) {
      experiencesGrid.style.display = 'none';
      noResults.style.display = 'flex';
    } else {
      experiencesGrid.style.display = 'grid';
      noResults.style.display = 'none';
    }
  }
  
  function resetFilters() {
    searchInput.value = '';
    typeCheckboxes.forEach(checkbox => checkbox.checked = true);
    tagFilter.value = '';
    resumeSelectInputs.forEach(input => input.checked = true);
    filterExperiences();
    if (pdfModal.style.display === 'flex') {
      updatePDFPreview();
    }
  }
  
  searchInput.addEventListener('input', () => {
    filterExperiences();
    if (pdfModal.style.display === 'flex') {
      updatePDFPreview();
    }
  });
  
  typeCheckboxes.forEach(checkbox => {
    checkbox.addEventListener('change', () => {
      filterExperiences();
      if (pdfModal.style.display === 'flex') {
        updatePDFPreview();
      }
    });
  });
  
  tagFilter.addEventListener('change', () => {
    filterExperiences();
    if (pdfModal.style.display === 'flex') {
      updatePDFPreview();
    }
  });
  
  resumeSelectInputs.forEach(input => {
    input.addEventListener('change', () => {
      if (pdfModal.style.display === 'flex') {
        updatePDFPreview();
      }
    });
  });
  
  resetBtn.addEventListener('click', resetFilters);
</script>

<style>
  .resume-search {
    margin-top: var(--spacing-2xl);
  }
  
  .search-controls {
    background-color: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-xl);
    margin-bottom: var(--spacing-xl);
  }
  
  .search-bar {
    position: relative;
    margin-bottom: var(--spacing-lg);
  }
  
  .search-icon {
    position: absolute;
    left: var(--spacing-md);
    top: 50%;
    transform: translateY(-50%);
    color: var(--color-text-tertiary);
    pointer-events: none;
  }
  
  .search-input {
    width: 100%;
    padding: var(--spacing-md) var(--spacing-md) var(--spacing-md) 3rem;
    background-color: var(--color-surface-elevated);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text-primary);
    font-size: 1rem;
    transition: all var(--transition-base);
  }
  
  .search-input:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1);
  }
  
  .filters {
    display: flex;
    gap: var(--spacing-md);
    flex-wrap: wrap;
    align-items: center;
  }
  
  .filter-group {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
  }
  
  .type-filter-group {
    flex-wrap: wrap;
    gap: var(--spacing-md);
  }
  
  .filter-label {
    font-size: 0.9rem;
    color: var(--color-text-secondary);
    font-weight: 500;
  }
  
  .type-checkboxes {
    display: flex;
    gap: var(--spacing-md);
    flex-wrap: wrap;
  }
  
  .type-checkbox-label {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    cursor: pointer;
    user-select: none;
    padding: var(--spacing-xs) var(--spacing-sm);
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
  }
  
  .type-checkbox-label:hover {
    background-color: var(--color-surface-elevated);
  }
  
  .type-checkbox {
    width: 16px;
    height: 16px;
    cursor: pointer;
    accent-color: var(--color-primary);
  }
  
  .type-checkbox-label span {
    font-size: 0.9rem;
    color: var(--color-text-primary);
  }
  
  .filter-select {
    padding: var(--spacing-sm) var(--spacing-md);
    background-color: var(--color-surface-elevated);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text-primary);
    font-size: 0.95rem;
    cursor: pointer;
    transition: all var(--transition-base);
  }
  
  .filter-select:focus {
    outline: none;
    border-color: var(--color-primary);
  }
  
  .resume-preview-btn {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm) var(--spacing-lg);
    background-color: var(--color-primary);
    color: var(--color-background);
    border: none;
    border-radius: var(--radius-md);
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-base);
    margin-left: auto;
  }
  
  .resume-preview-btn:hover {
    background-color: #5b9ee0;
    box-shadow: 0 2px 8px rgba(96, 165, 250, 0.3);
  }
  
  .reset-btn {
    padding: var(--spacing-sm) var(--spacing-lg);
    background-color: var(--color-surface-elevated);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text-secondary);
    font-size: 0.95rem;
    font-weight: 500;
    transition: all var(--transition-base);
  }
  
  .reset-btn:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
  }
  
  .results-info {
    margin-bottom: var(--spacing-lg);
    color: var(--color-text-secondary);
    font-size: 0.95rem;
  }
  
  .results-info span {
    color: var(--color-primary);
    font-weight: 600;
  }
  
  .experiences-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-3xl);
  }
  
  .experience-card {
    background-color: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-xl);
    transition: all var(--transition-base);
    animation: fadeIn 0.3s ease;
  }
  
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .experience-card:hover {
    transform: translateY(-4px);
    border-color: var(--color-primary);
    box-shadow: 0 10px 30px rgba(96, 165, 250, 0.2);
  }
  
  .experience-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: var(--spacing-md);
    gap: var(--spacing-md);
  }
  
  .experience-header-left {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
    flex: 1;
  }
  
  .resume-select-checkbox {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    cursor: pointer;
    user-select: none;
    padding: var(--spacing-xs) 0;
  }
  
  .resume-select-input {
    width: 18px;
    height: 18px;
    cursor: pointer;
    accent-color: var(--color-primary);
  }
  
  .checkbox-label {
    font-size: 0.85rem;
    color: var(--color-text-secondary);
    font-weight: 500;
  }
  
  .resume-select-checkbox:hover .checkbox-label {
    color: var(--color-primary);
  }
  
  .experience-type-badge {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    padding: 0.25rem 0.75rem;
    border-radius: var(--radius-sm);
    letter-spacing: 0.05em;
    align-self: flex-start;
  }
  
  .experience-type-badge[data-type="courses"] {
    background-color: var(--color-primary);
    color: var(--color-background);
  }
  
  .experience-type-badge[data-type="research"] {
    background-color: var(--color-accent);
    color: var(--color-background);
  }
  
  .experience-type-badge[data-type="projects"] {
    background-color: var(--color-accent-secondary);
    color: var(--color-background);
  }
  
  .experience-type-badge[data-type="education"] {
    background-color: #a78bfa;
    color: var(--color-background);
  }
  
  .experience-type-badge[data-type="awards"] {
    background-color: #f472b6;
    color: var(--color-background);
  }

  .experience-type-badge[data-type="work"] {
    background-color: #f472b6;
    color: var(--color-background);
  }
  
  .experience-date {
    font-size: 0.85rem;
    color: var(--color-text-tertiary);
    font-family: var(--font-mono);
  }
  
  .experience-title {
    font-size: 1.25rem;
    margin-bottom: var(--spacing-sm);
    color: var(--color-text-primary);
  }
  
  .experience-org {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    color: var(--color-text-secondary);
    font-size: 0.95rem;
    margin-bottom: var(--spacing-md);
  }
  
  .org-icon {
    flex-shrink: 0;
  }
  
  .experience-description {
    font-size: 0.95rem;
    line-height: 1.6;
    margin-bottom: var(--spacing-md);
  }
  
  .experience-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: var(--spacing-md);
    flex-wrap: wrap;
    margin-top: var(--spacing-md);
    padding-top: var(--spacing-md);
    border-top: 1px solid var(--color-border);
  }
  
  .experience-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-xs);
    flex: 1;
  }
  
  .tag {
    font-size: 0.8rem;
    padding: 0.25rem 0.75rem;
    background-color: var(--color-surface-elevated);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    color: var(--color-text-secondary);
    transition: all var(--transition-fast);
  }
  
  .tag:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
  }
  
  .project-link-btn {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-xs);
    padding: var(--spacing-xs) var(--spacing-md);
    background-color: var(--color-primary);
    color: var(--color-background);
    border-radius: var(--radius-sm);
    font-size: 0.85rem;
    font-weight: 500;
    transition: all var(--transition-base);
    white-space: nowrap;
    text-decoration: none;
  }
  
  .project-link-btn:hover {
    background-color: var(--color-primary-hover);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(96, 165, 250, 0.3);
  }
  
  .project-link-btn svg {
    flex-shrink: 0;
  }
  
  .no-results {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: var(--spacing-3xl);
    text-align: center;
    color: var(--color-text-tertiary);
  }
  
  .no-results svg {
    margin-bottom: var(--spacing-lg);
    opacity: 0.5;
  }
  
  .no-results h3 {
    color: var(--color-text-secondary);
    margin-bottom: var(--spacing-sm);
  }
  
  @media (max-width: 768px) {
    .experiences-grid {
      grid-template-columns: 1fr;
    }
    
    .filters {
      flex-direction: column;
      align-items: stretch;
    }
    
    .filter-group {
      width: 100%;
    }
    
    .type-filter-group {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .type-checkboxes {
      width: 100%;
      flex-direction: column;
      gap: var(--spacing-sm);
    }
    
    .filter-select {
      flex: 1;
      width: 100%;
    }
    
    .resume-preview-btn,
    .reset-btn {
      margin-left: 0;
      width: 100%;
      justify-content: center;
    }
    
    .experience-header {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .experience-date {
      align-self: flex-end;
    }
    
    .experience-footer {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .project-link-btn {
      width: 100%;
      justify-content: center;
    }
  }
  
  /* Added PDF modal styles */
  .pdf-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    padding: var(--spacing-lg);
  }
  
  .pdf-modal-content {
    background-color: var(--color-background);
    border-radius: var(--radius-lg);
    width: 100%;
    max-width: 900px;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  }
  
  .pdf-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-xl);
    border-bottom: 1px solid var(--color-border);
  }
  
  .pdf-modal-header h2 {
    margin: 0;
    color: var(--color-text-primary);
  }
  
  .close-modal-btn {
    background: none;
    border: none;
    color: var(--color-text-secondary);
    cursor: pointer;
    padding: var(--spacing-sm);
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
  }
  
  .close-modal-btn:hover {
    background-color: var(--color-surface);
    color: var(--color-text-primary);
  }
  
  .pdf-preview-area {
    flex: 1;
    overflow-y: auto;
    padding: var(--spacing-xl);
    background-color: var(--color-surface);
  }
  
  .pdf-content {
    background-color: white;
    padding: var(--spacing-2xl);
    border-radius: var(--radius-md);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    max-width: 800px;
    margin: 0 auto;
  }
  
  .pdf-header {
    text-align: center;
    margin-bottom: var(--spacing-2xl);
    padding-bottom: var(--spacing-xl);
    border-bottom: 2px solid #e5e7eb;
  }
  
  .pdf-header h1 {
    color: #1f2937;
    margin-bottom: var(--spacing-sm);
    font-size: 2rem;
  }
  
  .pdf-subtitle {
    color: #6b7280;
    font-size: 1rem;
  }
  
  .pdf-experience-item {
    margin-bottom: var(--spacing-xl);
    padding-bottom: var(--spacing-xl);
    border-bottom: 1px solid #e5e7eb;
  }
  
  .pdf-experience-item:last-child {
    border-bottom: none;
  }
  
  .pdf-exp-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: var(--spacing-sm);
    gap: var(--spacing-md);
  }
  
  .pdf-exp-title {
    color: #1f2937;
    font-size: 1.15rem;
    margin-bottom: 0.25rem;
  }
  
  .pdf-exp-org {
    color: #6b7280;
    font-size: 0.95rem;
    margin: 0;
  }
  
  .pdf-exp-date {
    color: #9ca3af;
    font-size: 0.85rem;
    font-family: var(--font-mono);
    white-space: nowrap;
  }
  
  .pdf-exp-description {
    color: #4b5563;
    font-size: 0.95rem;
    line-height: 1.6;
    margin-bottom: var(--spacing-sm);
  }
  
  .pdf-exp-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-xs);
  }
  
  .pdf-tag {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    background-color: #f3f4f6;
    color: #6b7280;
    border-radius: var(--radius-sm);
  }
  
  .no-experiences {
    text-align: center;
    color: #9ca3af;
    padding: var(--spacing-2xl);
  }
  
  .pdf-modal-footer {
    padding: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
    display: flex;
    justify-content: flex-end;
  }
  
  .download-pdf-btn {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-md) var(--spacing-xl);
    background-color: var(--color-primary);
    color: var(--color-background);
    border: none;
    border-radius: var(--radius-md);
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-base);
  }
  
  .download-pdf-btn:hover {
    background-color: #5b9ee0;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(96, 165, 250, 0.3);
  }
</style>
